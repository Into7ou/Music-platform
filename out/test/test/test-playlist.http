### ========================================
### Playlist Module API 测试
### ========================================

### 环境变量
@baseUrl = http://localhost:8080

### ----------------------------------------
### 准备工作：查询现有歌曲（用于后续添加到歌单）
### ----------------------------------------
GET {{baseUrl}}/music/list?page=1&size=5


### ========================================
### 1. 创建歌单
### ========================================

### 1.1 创建私密歌单
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "我的私密歌单",
  "description": "这是一个私密歌单，只有我能看到",
  "isPublic": 0
}

### 1.2 创建公开歌单
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "我的公开歌单",
  "description": "这是一个公开歌单，所有人都能看到",
  "coverUrl": "https://example.com/cover.jpg",
  "isPublic": 1
}

### 1.3 创建没有描述的歌单
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "简单歌单",
  "isPublic": 0
}

### 1.4 创建歌单 - 缺少必填字段（预期返回错误）
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "description": "没有名称的歌单"
}

### 1.5 创建歌单 - 名称为空（预期返回错误）
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "",
  "description": "空名称测试"
}


### ========================================
### 2. 查询歌单
### ========================================

### 2.1 获取我的所有歌单
GET {{baseUrl}}/playlist/my

### 2.2 获取我的默认歌单 (i_like)
GET {{baseUrl}}/playlist/my/default

### 2.3 获取歌单详情（替换为实际创建的歌单 ID）
GET {{baseUrl}}/playlist/1

### 2.4 获取不存在的歌单（预期返回错误）
GET {{baseUrl}}/playlist/99999

### 2.5 获取公开歌单列表（分页）
GET {{baseUrl}}/playlist/public?page=1&size=10

### 2.6 获取公开歌单列表（默认分页）
GET {{baseUrl}}/playlist/public


### ========================================
### 3. 更新歌单
### ========================================

### 3.1 更新歌单名称和描述（替换为实际歌单 ID）
PUT {{baseUrl}}/playlist/2
Content-Type: application/json

{
  "name": "更新后的歌单名称",
  "description": "更新后的歌单描述"
}

### 3.2 将歌单设为公开（替换为实际歌单 ID）
PUT {{baseUrl}}/playlist/2
Content-Type: application/json

{
  "isPublic": 1
}

### 3.3 将歌单设为私密（替换为实际歌单 ID）
PUT {{baseUrl}}/playlist/2
Content-Type: application/json

{
  "isPublic": 0
}

### 3.4 更新歌单封面（替换为实际歌单 ID）
PUT {{baseUrl}}/playlist/2
Content-Type: application/json

{
  "coverUrl": "https://example.com/new-cover.jpg"
}

### 3.5 同时更新多个字段（替换为实际歌单 ID）
PUT {{baseUrl}}/playlist/2
Content-Type: application/json

{
  "name": "完整更新的歌单",
  "description": "更新了所有字段",
  "coverUrl": "https://example.com/cover-v2.jpg",
  "isPublic": 1
}


### ========================================
### 4. 歌单歌曲管理
### ========================================

### 4.1 添加歌曲到歌单（替换为实际的歌单 ID 和歌曲 ID）
POST {{baseUrl}}/playlist/2/songs/1

### 4.2 添加多个歌曲到歌单（需要分别调用）
POST {{baseUrl}}/playlist/2/songs/2

###
POST {{baseUrl}}/playlist/2/songs/3

###
POST {{baseUrl}}/playlist/2/songs/4

### 4.3 添加不存在的歌曲（预期返回错误）
POST {{baseUrl}}/playlist/2/songs/99999

### 4.4 重复添加同一首歌曲（预期返回错误）
POST {{baseUrl}}/playlist/2/songs/1

### 4.5 获取歌单的所有歌曲（替换为实际歌单 ID）
GET {{baseUrl}}/playlist/2/songs

### 4.6 从歌单移除歌曲（替换为实际的歌单 ID 和歌曲 ID）
DELETE {{baseUrl}}/playlist/2/songs/4

### 4.7 从歌单移除不存在的歌曲（预期返回错误）
DELETE {{baseUrl}}/playlist/2/songs/99999

### 4.8 从歌单移除已移除的歌曲（预期返回错误）
DELETE {{baseUrl}}/playlist/2/songs/4


### ========================================
### 5. 删除歌单
### ========================================

### 5.1 删除自定义歌单（替换为实际歌单 ID）
DELETE {{baseUrl}}/playlist/3

### 5.2 尝试删除默认歌单 (i_like)（预期返回错误）
DELETE {{baseUrl}}/playlist/1

### 5.3 删除不存在的歌单（预期返回错误）
DELETE {{baseUrl}}/playlist/99999


### ========================================
### 6. 完整工作流测试
### ========================================

### 6.1 步骤1: 创建一个新歌单
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "完整流程测试歌单",
  "description": "用于测试完整工作流",
  "isPublic": 0
}

### 6.2 步骤2: 查看我的所有歌单（确认创建成功）
GET {{baseUrl}}/playlist/my

### 6.3 步骤3: 添加几首歌曲（替换为实际的歌单 ID 和歌曲 ID）
POST {{baseUrl}}/playlist/5/songs/1

###
POST {{baseUrl}}/playlist/5/songs/2

###
POST {{baseUrl}}/playlist/5/songs/3

### 6.4 步骤4: 查看歌单歌曲列表
GET {{baseUrl}}/playlist/5/songs

### 6.5 步骤5: 将歌单设为公开
PUT {{baseUrl}}/playlist/5
Content-Type: application/json

{
  "isPublic": 1
}

### 6.6 步骤6: 查看公开歌单列表（应该能看到刚刚设为公开的歌单）
GET {{baseUrl}}/playlist/public

### 6.7 步骤7: 从歌单中移除一首歌曲
DELETE {{baseUrl}}/playlist/5/songs/3

### 6.8 步骤8: 再次查看歌单歌曲列表（确认移除成功）
GET {{baseUrl}}/playlist/5/songs

### 6.9 步骤9: 将歌单设为私密
PUT {{baseUrl}}/playlist/5
Content-Type: application/json

{
  "isPublic": 0
}

### 6.10 步骤10: 查看公开歌单列表（应该看不到刚设为私密的歌单）
GET {{baseUrl}}/playlist/public

### 6.11 步骤11: 删除测试歌单
DELETE {{baseUrl}}/playlist/5


### ========================================
### 7. 边界测试
### ========================================

### 7.1 无效的歌单 ID（负数）
GET {{baseUrl}}/playlist/-1

### 7.2 无效的歌单 ID（字符串，预期 400 错误）
GET {{baseUrl}}/playlist/abc

### 7.3 无效的歌曲 ID（负数）
POST {{baseUrl}}/playlist/2/songs/-1

### 7.4 空名称创建歌单
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "   ",
  "description": "空格名称"
}

### 7.5 超长名称创建歌单（测试字段长度限制）
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "这是一个非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常非常长的歌单名称用于测试字段长度限制",
  "description": "测试"
}


### ========================================
### 8. 默认歌单 (i_like) 测试
### ========================================

### 8.1 获取默认歌单
GET {{baseUrl}}/playlist/my/default

### 8.2 向默认歌单添加歌曲（替换为歌曲 ID）
POST {{baseUrl}}/playlist/1/songs/1

### 8.3 查看默认歌单的歌曲
GET {{baseUrl}}/playlist/1/songs

### 8.4 从默认歌单移除歌曲
DELETE {{baseUrl}}/playlist/1/songs/1

### 8.5 尝试删除默认歌单（应该失败）
DELETE {{baseUrl}}/playlist/1

### 8.6 尝试修改默认歌单的名称（应该成功，但不影响 is_default 字段）
PUT {{baseUrl}}/playlist/1
Content-Type: application/json

{
  "name": "我喜欢",
  "description": "我的最爱"
}


### ========================================
### 9. 并发与性能测试（可选）
### ========================================

### 9.1 批量创建歌单（手动多次执行）
POST {{baseUrl}}/playlist/create
Content-Type: application/json

{
  "name": "批量测试歌单-{{$randomInt}}",
  "description": "批量测试",
  "isPublic": 0
}

### 9.2 查询大量数据
GET {{baseUrl}}/playlist/public?page=1&size=100


### ========================================
### 测试提示
### ========================================
### 
### 1. 测试前请确保：
###    - 数据库表已创建（sys_playlist, sys_playlist_song）
###    - 触发器已创建
###    - music_db 中已有至少 5 首歌曲
###    - Spring Boot 应用已启动
### 
### 2. 替换占位符：
###    - 将 {歌单ID} 替换为实际创建的歌单 ID
###    - 将 {歌曲ID} 替换为数据库中实际存在的歌曲 ID
###    - 可先查询 GET /music/list 获取歌曲列表
### 
### 3. 测试顺序建议：
###    - 先执行 1-2 节（创建和查询）
###    - 再执行 4 节（歌曲管理）
###    - 然后执行 3 节（更新）
###    - 最后执行 5 节（删除）
### 
### 4. 预期结果：
###    - 成功操作返回 {"code": 200, "message": "success", ...}
###    - 失败操作返回 {"code": xxx, "message": "错误信息"}
### 
### ========================================


POST http://localhost:8080/auth/login
Content-Type: application/json

{
  "username": "test1",
  "password": "123456"
}

### 1. 登录 test1 (复制返回的 token)
POST http://localhost:8080/auth/login
Content-Type: application/json

{
  "username": "test1",
  "password": "123456"
}

### 2. 获取 test1 的歌单 (应该有默认的 i_like 歌单)
GET http://localhost:8080/playlist/my
Authorization: mock-token-f65f5828-6788-4420-b35f-cb53fb2ae82a